!function(e){"use strict";function t(e,t,r){for(var s,a=/[`$\\]/g;a.lastIndex=t,a.exec(e);){if(t=a.lastIndex,"`"===(s=e[t-1]))return t;if("$"===s&&"{"===e[t++])return r.push(n,"}"),t}throw new Error("Unclosed ES6 template")}function r(e,t){return new h(e,t||{})}function s(e,t){return new u(t||r,e)}var n="`";module.exports=t;var a=function(e){return e.replace(/(?=[-[\](){^*+?.$|\\])/g,"\\")},o=function(e,t,r){function s(e){var t=o[e];if(!t){var s=r(e);e.length>1?s+="|[":s=/[\{}[\]()]/.test(e)?"[":"["+s,o[e]=t=new RegExp(a+"|"+s+"`/\\{}[\\]()]","g")}return t}var n=/'[^'\n\r\\]*(?:\\(?:\r\n?|[\S\s])[^'\n\r\\]*)*'/.source,a=n+"|"+n.replace(/'/g,'"'),o={};return function(r,n,a){var o=a[0],l=a[1],p=n+o.length,i=[],c=s(l);c.lastIndex=p;for(var u,f,d,h;h=c.exec(r);){if(u=h.index,f=c.lastIndex,(d=h[0])===l&&!i.length)return{text:r.slice(p,u),start:n,end:f};switch(d=d[0]){case"[":case"(":case"{":i.push("["===d?"]":"("===d?")":"}");break;case")":case"]":case"}":if(d!==i.pop())throw new Error("Unexpected character '"+d+"'");"}"===d&&"`"===i[i.length-1]&&(d=i.pop()),f=u+1;break;case"/":f=t(r,u)}c.lastIndex="`"===d?e(r,f,i):f}if(i.length)throw new Error("Unclosed expression.");return null}}(t=require("./skip-es6-tl"),require("skip-regex"),a),l=function(e,t,r){r||(r=e.length);for(var s=(e.slice(0,r).match(/\r\n?|\n/g)||"").length+1,n=0;--r>=0&&!/[\r\n]/.test(e[r]);)++n;return"["+s+","+n+"]: "+t},p={rootTagNotFound:"Root tag not found.",unexpectedEndOfFile:"Unexpected end of file.",unclosedComment:"Unclosed comment.",unclosedNamedBlock:'Unclosed "%1" block.',duplicatedNamedTag:'Duplicate tag "<%1>".',expectedAndInsteadSaw:'Expected "</%1>" and instead saw "<%2>".'},i=/^(?:\/[a-zA-Z]|[a-zA-Z][^\s>\/]?)/,c={script:/<\/script\s*>/gi,style:/<\/style\s*>/gi,textarea:/<\/textarea\s*>/gi},u=function(){function e(e,t){this.opts=t,this.bf=e,this.bp=t.brackets,this.cm=!0===t.comments,this.re={}}return e.prototype.parse=function(e,t){for(var r=this,s=r.bf(e,r.opts),n={pos:0|t,last:null,count:-1,scryle:null,builder:s,data:e},a=e.length,o=3;n.pos<a&&n.count;)3===o?o=r.text(n,e):1===o?o=r.tag(n,e):2===o&&(o=r.attr(n,e));return r.flush(n),n.count&&r.err(e,n.count>0?p.unexpectedEndOfFile:p.rootTagNotFound,n.pos),{data:e,output:s.get()}},e.prototype.err=function(e,t,r){var s=l(e,t,r);throw new Error(s)},e.prototype.flush=function(e){var t=e.last;e.last=null,t&&e.root&&e.builder.push(t)},e.prototype.pushCmnt=function(e,t,r){this.flush(e),e.pos=r,!0===this.cm&&(e.last={type:8,start:t,end:r})},e.prototype.pushText=function(e,t,r,s,n){var a=e.data.slice(t,r),o=e.last;e.pos=r,o&&3===o.type?(o.text+=a,o.end=r):(this.flush(e),e.last=o={type:3,text:a,start:t,end:r}),s&&(o.expr=(o.expr||[]).concat(s)),n&&(o.unescape=n)},e.prototype.pushTag=function(e,t,r,s){var n=e.root,a={type:1,name:t,start:r,end:s};e.pos=s,n?(t===n.name?e.count++:t===n.close&&e.count--,this.flush(e)):(e.root={name:a.name,close:"/"+t},e.count=1),e.last=a},e.prototype.tag=function(e,t){var r=e.pos,s=r-1,n=t.substr(r,2);if("!"===n[0])this.cmnt(e,t,s);else if(i.test(n)){var a=/(\/?[^\s>\/]+)\s*(>)?/g;a.lastIndex=r;var o=a.exec(t),l=a.lastIndex,p=o[1].toLowerCase();if(p in c&&(e.scryle=p),this.pushTag(e,p,s,l),!o[2])return 2}else this.pushText(e,s,r);return 3},e.prototype.cmnt=function(e,t,r){var s=r+2,n="--"===t.substr(s,2)?"--\x3e":">",a=t.indexOf(n,s);a<0&&this.err(t,p.unclosedComment,r),this.pushCmnt(e,r,a+n.length)},e.prototype.attr=function(e,t){var r=e.last,s=/\S/g;s.lastIndex=e.pos;var n=s.exec(t);if(n){if(">"===n[0])return e.pos=r.end=s.lastIndex,r.selfclose&&(e.scryle=null,e.root&&e.root.name===r.name&&e.count--),3;"/"===n[0]?(e.pos=s.lastIndex,r.selfclose=!0):(delete r.selfclose,this.setAttr(e,t,n.index,r))}else e.pos=t.length;return 2},e.prototype.setAttr=function(e,t,r,s){var n=/(\S[^>\/=\s]*)(?:\s*=\s*([^>\/])?)?/g,a=n.lastIndex=r,o=n.exec(t);if(o){var l=n.lastIndex,p=o[2],i={name:o[1],value:"",start:a,end:l};if(p){var c=l;'"'!==p&&"'"!==p&&(p="",c--),l=this.expr(e,t,i,p||"[>/\\s]",c),i.value=t.slice(c,l),i.valueStart=c,i.end=p?++l:l}e.pos=s.end=l,(s.attr||(s.attr=[])).push(i)}},e.prototype.text=function(e,t){var r=this,s=e.pos;if(e.scryle){var n=e.scryle,a=c[n];a.lastIndex=s;var o=a.exec(t);o||r.err(t,p.unclosedNamedBlock.replace("%1",n),s-1);var l=o.index,i=a.lastIndex;e.scryle=null,l>s&&("textarea"===n?this.expr(e,t,null,o[0],s):r.pushText(e,s,l)),r.pushTag(e,"/"+n,l,i)}else{if("<"===t[s])return e.pos++,1;this.expr(e,t,null,"<",s)}return 3},e.prototype.expr=function(e,t,r,s,n){var a,l,i=this,c=n,u="",f=i.b0re(s);for(f.lastIndex=n;(l=f.exec(t))&&!l[1];)if(n=l.index,"\\"===t[n-1])u=l[0];else{var d=o(t,n,i.bp);d&&((a||(a=[])).push(d),f.lastIndex=d.end)}l||i.err(t,p.unexpectedEndOfFile,n);var h=l.index;return r?(u&&(r.unescape=u),a&&(r.expr=a)):i.pushText(e,c,h,a,u),h},e.prototype.b0re=function(e){var t=this.re[e];if(!t){var r=a(this.bp[0]);this.re[e]=t=new RegExp("("+e+")|"+r,"g")}return t},e}(),f={html:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],svg:["circle","ellipse","line","path","polygon","polyline","rect","stop","use"]},d=/^\/?(?:pre|textarea)$/,h=function(){function e(e,t){var r={type:1,name:"",start:0,end:0,nodes:[]};this.compact=!1!==t.compact,this.prefixes="^?=",this.state={last:r,stack:[],scryle:null,root:r,style:null,script:null,data:e}}return e.prototype.get=function(){var e=this.state;return{html:e.root.nodes[0],css:e.style,js:e.script}},e.prototype.push=function(e){var t=this.state;if(3===e.type)this.pushText(t,e);else if(1===e.type){var r=e.name;"/"===r[0]?this.closeTag(t,e,r):this.openTag(t,e)}},e.prototype.err=function(e,t){var r=l(this.state.data,e,t);throw new Error(r)},e.prototype.closeTag=function(e,t,r){var s=e.scryle||e.last,n=s.name;if(n!==r.slice(1)){var a=p.expectedAndInsteadSaw.replace("%1",n).replace("%2",r);this.err(a,s.start)}s.end=t.end,e.scryle?e.scryle=null:(e.stack[0]||this.err("Stack is empty.",s.start),e.last=e.stack.pop())},e.prototype.openTag=function(e,t){var r=t.name,s=e.last.ns||("svg"===r?"http://www.w3.org/2000/svg":""),n=t.attr;if(n&&!s&&n.forEach(function(e){e.name=e.name.toLowerCase()}),"style"===r||"script"===r&&!this.deferred(t,n))e[r]&&this.err(p.duplicatedNamedTag.replace("%1",r),t.start),e[r]=t,t.selfclose||(e.scryle=e[r]);else{var a=e.last,o=t;a.nodes.push(o),(a.raw||d.test(r))&&(o.raw=!0);var l=void 0;s?(o.ns=s,l=f.svg):l=f.html,~l.indexOf(r)?o.void=!0:t.selfclose||(e.stack.push(a),o.nodes=[],e.last=o)}n&&this.attrs(n)},e.prototype.deferred=function(e,t){if(t)for(var r=0;r<t.length;r++)if("defer"===t[r].name)return t.splice(r,1),!0;return!1},e.prototype.attrs=function(e){for(var t=0;t<e.length;t++){var r=e[t];r.value&&this.split(r,r.value,r.valueStart,!0)}},e.prototype.pushText=function(e,t){var r=t.text,s=!/\S/.test(r),n=e.scryle;if(n)s||(n.text=t);else{var a=e.last,o=this.compact&&!a.raw;if(o&&s)return;this.split(t,r,t.start,o),a.nodes.push(t)}},e.prototype.split=function(e,t,r,s){var n=e.expr,a=[];if(n){for(var o=0,l=0;l<n.length;l++){var p=n[l],i=t.slice(o,p.start-r),c=p.text;~this.prefixes.indexOf(c[0])&&(p.prefix=c[0],c=c.substr(1)),a.push(this._tt(e,i,s),c.replace(/\\/g,"\\\\").trim().replace(/\r/g,"\\r").replace(/\n/g,"\\n")),o=p.end-r}(o+=r)<e.end&&a.push(this._tt(e,t.slice(o),s))}else a[0]=this._tt(e,t,s);e.parts=a},e.prototype._tt=function(e,t,r){var s=e.unescape;if(s){var n=0;for(s="\\"+s;~(n=t.indexOf(s,n));)t=t.substr(0,n)+t.substr(n+1),n++}return t=t.replace(/\\/g,"\\\\"),r?t.replace(/\s+/," "):t.replace(/\r/g,"\\r").replace(/\n/g,"\\n")},e}();module.exports=s}("undefined"==typeof p?p={}:p);
